'use strict'

/**
 * @module      algorithm/round-robin
 * @since       0.0.2
 * @desc        index 기반으로 GPU load balancing
*/

const utils = require('@amuzlab/utils'),
    sysInfo = require('../sys-info')

let index = 0

Object.defineProperties(
    exports,
    {
        /**
         * @name        getGPU
         * @desc        get available gpu device
         * @param       {Object|String=}    options                                 gpu load balancing options
         * @returns     {Object}            현재 index의 GPU를 리턴
         * @throws      {Error}             Does not exist available GPU
         * @function
         * @static
         * @public
         * @readonly
         * @since       0.0.2
        */
        getGPU: {
            enumerable: true,
            value: async options => {
                let gpus = await sysInfo.getSysInfo().gpu.gpus,
                    gpu = gpus.gpus[index],
                    err

                if (!gpu) {
                    err = new Error(`Does not exist available GPU (index : ${index})`)
                    err.index = index
                    throw err
                }

                index++
                index %= gpus.gpus.length

                return gpu
            }
        }
    })
