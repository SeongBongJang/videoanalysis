'use strict'

/**
 * @module      algorithm/round-robin-mem
 * @since       0.0.1
 * @desc        사용중인 메모리가 가장 적은 GPU를 리턴
*/

const utils = require('@amuzlab/utils'),
    sysInfo = require('../sys-info')

Object.defineProperties(
    exports,
    {
        /**
         * @name        getGPU
         * @desc        get available gpu device
         * @param       {Object|String=}    options                                 gpu load balancing options
         * @returns     {Object}            사용중인 메모리가 가장 적은 GPU
         * @function
         * @static
         * @public
         * @readonly
         * @since       0.0.1
        */
        getGPU: {
            enumerable: true,
            value: async options => {
                let gpus = await sysInfo.getSysInfo().gpu.gpus
                
                return utils.reduce(
                    gpus.gpus,
                    (gpu, _gpu) => {
                        _gpu.usage.memory.used < gpu.usage.memory.used && (gpu = _gpu)
                        return gpu
                    })
            }
        }
    })
