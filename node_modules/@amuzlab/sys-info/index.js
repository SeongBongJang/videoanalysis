'use strict'

const config = require('./config'),
    gpu = require('./gpu'),
    cpuMem = require('./cpu-mem')

module.exports = exports = config => {
    exports.config = config

    return exports
}

Object.defineProperties(
    exports,
    {
        config: {
            /**
             * @global
             * @name    get:config
             * @desc    모듈 설정 정보 리턴
             * @function
             * @returns {module:config}     모듈 설정 정보
             * @static
             * @public
             * @since   1.0.0
             * @see     {@link module:config config}
            */
            get: () => {
                return config
            },
            /**
             * @global
             * @name    set:config
             * @desc    모듈 설정 정보 세팅
             * @function
             * @static
             * @public
             * @param   {Object}    config                  - 모듈 설정
             * @param   {Boolean}   config.useGPU           - GPU 사용 여부
             * @param   {Boolean}   config.isDisplayUnit    - 단위 표시 여부
             * @since   1.0.0
             * @see     {@link module:config config}
            */
            set: _config => {
                config.config = _config
                config.useGPU && (exports._gpu = gpu())
            }
        },
        /**
         * @global
         * @name    _gpu
         * @desc    gpu 정보 조회 및 세팅 모듈
         * @type    {module:gpu}
         * @static
         * @private
         * @since   1.0.0
         * @see     {@link module:gpu gpu}
        */
        _gpu: {
            writable: true,
            value: null               
        },
        gpu: {
            /**
             * @global
             * @name    get:gpu
             * @desc    gpu 정보 조회 및 세팅 모듈 리턴
             * @returns {module:gpu}    gpu 정보 조회 및 세팅 모듈
             * @static
             * @public
             * @since   1.0.0
             * @see     {@link module:gpu gpu}
            */
            get: () => {
                return exports._gpu
            }
        },
        /**
         * @global
         * @name    getProcessUsage
         * @desc    process 리소스 사용량 리턴
         * @function
         * @static
         * @public
         * @param       {Number}    pid     host에 설치된 gpu 리스트
         * @returns     {Object}    usage   process 리소스 사용량
         * @throws      {Error}     전달된 pid 없음
         * @since   1.1.0
        */
        getProcessUsage: {
            enumerable: true,
            value: async pid => {
                return await cpuMem.getProcessUsage(pid)
            }
        }
    })
