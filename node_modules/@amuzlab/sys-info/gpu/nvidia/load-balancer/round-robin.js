'use strict'

/**
 * @module      gpu/nvidia/load-balancer/round-robin
 * @desc        GPU Load balancing 모듈<br/>
 *              GPU current index를 가지고 있고 호출 될 때마다 index  증가
 * @since       1.0.0
 * @date        2020-01-16
*/

let index = 0

Object.defineProperties(
    exports,
    {
        /**
         * @name        getGPU
         * @desc        사용 가능한 GPU를 리턴
         * @function
         * @static
         * @public
         * @param       {Array}     gpus    - host에 설치된 gpu 리스트
         * @returns     {Object}    gpu     - 사용 가능한 GPU 정보
         * @throws      {Error}     사용 가능한 GPU가 없음
         * @since       1.0.0
         * @date        2020-01-20
        */
        getGPU: {
            enumerable: true,
            value: gpus => {
                let gpu = gpus[index]

                if (gpu) {
                    index = (index + 1) % gpus.length
                    return gpu
                } else {
                    throw new Error('No GPU available')
                }
            }
        }
    })
