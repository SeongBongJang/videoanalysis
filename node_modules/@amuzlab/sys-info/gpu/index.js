'use strict'

/**
 * @module      gpu
 * @desc        gpu 정보 조회 및 세팅 모듈<br/>
 *              gpu driver를 체크하여 동적으로 모듈을 선택하여 리턴
 * @public
 * @returns     {module:gpu}    설치된 gpu driver에 맞게 구현된 gpu 정보 조회 및 세팅 모듈
 * @since       1.0.0
 * @date        2020-01-16
 * @see         {@link module:gpu/nvidia nvidia}
*/

const path = require('path'),
    fs = require('fs'),

    modules = [
        {
            command: 'nvidia-smi',
            modulePath: './nvidia'
        }
    ]

module.exports = exports = () => {
    let pathList = process.env.PATH
        .split(path.delimiter),

        gpuModule = modules.find(module => pathList.some(_path => {
            let result

            try {
                fs.statSync(path.join(_path, module.command))
                result = true
            } catch (err) {
                result = false
            } finally {
                return result
            }
        }))

    if (!gpuModule) {
        throw new Error('No GPU driver available in module')
    }

    return require(gpuModule.modulePath)
}
